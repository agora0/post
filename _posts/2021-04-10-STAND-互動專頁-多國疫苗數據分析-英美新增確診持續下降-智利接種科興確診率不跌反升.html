---
layout: post
title: "【互動專頁】多國疫苗數據分析　英美新增確診持續下降 　智利接種科興確診率不跌反升"
date: 2021-04-10 05:44:26.000000000 +00:00
link: https://thestandnews.com/society/%E4%BA%92%E5%8B%95%E5%B0%88%E9%A0%81-%E5%A4%9A%E5%9C%8B%E7%96%AB%E8%8B%97%E6%95%B8%E6%93%9A%E5%88%86%E6%9E%90-%E8%8B%B1%E7%BE%8E%E6%96%B0%E5%A2%9E%E7%A2%BA%E8%A8%BA%E6%8C%81%E7%BA%8C%E4%B8%8B%E9%99%8D-%E6%99%BA%E5%88%A9%E6%8E%A5%E7%A8%AE%E7%A7%91%E8%88%88%E7%A2%BA%E8%A8%BA%E7%8E%87%E4%B8%8D%E8%B7%8C%E5%8F%8D%E5%8D%87/
categories: stand
tags: blog
author: 互動專頁
---

<img width="600" src="https://images.weserv.nl/?url=cdn.thestandnews.com/media/photos/cache/vac-13_pvA1k_600x0.png" /><br /><br /><meta charset="utf-8">
<div class="g-meta" style="display: none;">全球多月來開始接種不同的武漢肺炎 (COVID-19) 疫苗，部份國家在廣泛接種疫苗後，確診率明顯下降，但同時亦有多國確診率不跌反升。</div>
<style type="text/css">.g-body {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0;
  width: 100%;
  font-family: droid sans, helvetica neue, Helvetica, Arial, sans-serif;
  color: #444;
}
.g-kicker {
  text-align: center;
  margin-bottom: 20px;
}
.g-kicker .g-inner {
  display: inline;
  padding: 0 2px 5px 2px;
  border-bottom: 1px solid #d3d3d3;
}
.g-header .g-headline {
  font-family: droid sans, helvetica neue, Helvetica, Arial, sans-serif;
  font-weight: 700;
  margin: 0 auto 25px auto;
  font-size: 32px;
  line-height: 1.8;
  max-width: 720px;
}
.g-subhed {
  font-family: droid sans, helvetica neue, Helvetica, Arial, sans-serif;
  font-weight: 700;
  margin: 60px auto 25px auto;
  font-size: 24px;
  max-width: 600px;
}
.g-text {
  font-family: droid sans, helvetica neue, Helvetica, Arial, sans-serif;
  max-width: 600px;
  margin: 16px auto;
  font-size: 16px;
  line-height: 1.8;
  color: #444;
}
.g-bold {
  font-weight: 700;
}
.g-graphic {
  margin: 25px auto;
}
.g-graphic-text {
  font-family: droid sans, helvetica neue, Helvetica, Arial, sans-serif;
}
.g-image {
  margin: 35px auto;
}
.g-image img {
  width: 100%;
  display: block;
  margin: 0 auto;
}
.g-image .g-credit {
  margin-top: 10px;
  font-size: 13px;
  text-align: center;
  color: #999;
  display: block;
}
.g-refer {
  border: 1px solid #ececec;
  border-radius: 5px;
  background: rgba(253, 232, 0, 0.05);
  padding: 10px 20px;
  max-width: 460px;
  margin: 35px auto;
}
.g-refer .g-text {
  font-size: 12px;
  margin: 0;
  line-height: 1.5;
}
.g-refer .g-text:first-child {
  margin-bottom: 5px;
  font-weight: 700;
}
.g-refer .g-bullet:before {
  content: "•";
  position: absolute;
  margin-left: -10px;
}
.g-break {
  margin: 50px auto;
  text-align: center;
}
.g-break em {
  margin-right: 40px;
  text-align: center;
}
.g-break em:last-child {
  margin-right: 0;
}
.cover-image-wrapper.mobile,
.author-wrapper {
  display: none !important;
}
.g-promo {
  max-width: 600px;
  margin: 25px auto;
  padding: 25px 0;
  border-top: 1px solid #ddd;
  border-bottom: 1px solid #ddd;
}
.g-promo a {
  color: #444;
  text-decoration: none;
  transition: opacity 0.2s;
}
.g-promo a:hover {
  opacity: 0.6;
}
.g-promo .g-promo-asset-cont,
.g-promo .g-promo-text-cont {
  display: inline-block;
  width: 100%;
  vertical-align: top;
}
@media screen and (min-width: 600px) {
  .g-promo .g-promo-asset-cont {
    width: calc(68% - 10px);
  }
}
@media screen and (min-width: 600px) {
  .g-promo .g-promo-text-cont {
    width: calc(32% - 10px);
  }
}
.g-promo .g-promo-text-cont {
  margin-right: 10px;
}
.g-promo .g-promo-tag {
  font-weight: 700;
  margin-bottom: 3px;
}
.g-promo .g-promo-hed {
  font-weight: 700;
  margin-bottom: 10px;
}
@media screen and (min-width: 460px) {
  .g-promo .g-promo-hed {
    max-width: none;
  }
}
.g-promo .g-promo-text {
  margin-bottom: 10px;
  font-size: 15px;
  padding: 0 16px;
}
@media screen and (min-width: 460px) {
  .g-promo .g-promo-text {
    padding: 0;
  }
}
.g-promo .g-youtube-cont {
  width: 100%;
  padding-bottom: 56%;
  position: relative;
}
.g-promo .g-youtube-cont iframe {
  position: absolute;
  top: 0;
  left: 0;
}
.g-promo .g-img-cont img {
  width: 100%;
}
.g-promo .g-mobile-hed {
  display: inline;
}
@media screen and (min-width: 460px) {
  .g-promo .g-mobile-hed {
    display: none;
  }
}
.g-promo .g-desktop-hed {
  display: none;
}
@media screen and (min-width: 460px) {
  .g-promo .g-desktop-hed {
    display: block;
  }
}
.g-note {
  font-size: 13px;
  text-align: center;
  color: #999;
}
.g-graphic svg {
  margin: 0 auto;
  display: inline-block;
  vertical-align: bottom;
  overflow: visible;
}
.g-graphic svg .axis path.domain {
  display: none;
}
.g-graphic svg .axis line {
  stroke: #d3d3d3;
  stroke-width: 0.5;
}
.g-graphic svg .axis text {
  fill: #999;
}
.g-graphic svg .y.axis text {
  text-anchor: start;
}
.g-graphic svg .x.axis line {
  stroke: #333;
}
.g-graphic svg .g-lab {
  font-size: 10px;
}
.g-graphic svg path {
  fill: none;
  stroke: none;
  shape-rendering: crispEdges;
}
.g-graphic svg .g-country-name {
  font-size: 13px;
  font-weight: 700;
}
.g-graphic svg .g-label {
  font-size: 10px;
  font-weight: 700;
}
.g-graphic .g-text {
  margin: 0 auto 10px auto;
  max-width: 600px;
  font-size: 14px;
}
.g-graphic-hed {
  font-weight: 700;
  max-width: 600px;
  margin: 0 auto;
  font-size: 22px;
  margin-bottom: 0;
}
.g-vaccine-example {
  max-width: 600px;
  margin: 0 auto;
}
.g-vaccine-example .g-summary-box {
  margin: 3px auto 10px auto;
  font-size: 11px;
  line-height: 1;
  vertical-align: bottom;
}
.g-vaccine-example .g-summary-box b {
  margin-right: 5px;
  font-weight: normal;
  color: #999;
}
.g-vaccine-example .g-summary-box .g-vaccine-summary {
  margin: 0 auto;
  display: inline;
  vertical-align: middle;
  margin-right: 5px;
  background: #f7f7f7;
  padding: 3px 5px 2px 5px;
  font-size: 11px;
}
.g-vaccine-example .g-vaccine-each {
  margin-right: 5px;
  display: inline-block;
  background: #f7f7f7;
  padding: 5px 5px 0 5px;
}
.g-vaccine-example .g-vaccine-each:last-child {
  margin-right: 0;
}
.g-vaccine-example .g-key-each {
  display: inline-block;
  margin-right: 10px;
}
.g-vaccine-example .g-key {
  font-size: 10px;
  position: absolute;
  background: #f7f7f7;
  margin-top: -10px;
}
.g-vaccine-example .g-key .g-key-rect {
  width: 8px;
  height: 8px;
  display: inline-block;
  vertical-align: middle;
  margin-right: 3px;
}
.g-vaccine-example .g-key .g-key-label {
  display: inline-block;
  vertical-align: middle;
}
.g-chart-hed {
  font-size: 13px;
  font-weight: 700;
  height: 30px;
}
@media screen and (min-width: 600px) {
}
.g-chart-hed i {
  display: block;
  font-size: 10px;
  color: #999;
  font-weight: normal;
  font-style: normal;
}
</style>
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<div class="g-body">
<div class="g-text">全球多月來開始接種不同的武漢肺炎 (COVID-19) 疫苗，部份國家在廣泛接種疫苗後，確診率明顯下降，但同時亦有多國確診率不跌反升。</div>
<div class="g-graphic">
<div class="g-vaccine-example" data-country="all"> </div>
</div>
<div class="g-text">香港現有兩款疫苗供接種 — 國產的科興疫苗及德國研發的 BioNTech ，兩者也在不同國家接種。約一半接種 BioNTech 的美國，疫情明顯好轉，但主要接種科興的智利，新增確診有上升趨勢。不過疫情反反覆覆，除了與接種不同疫苗有關，亦會被多個其他因素影響，例如當地有否放寬限制措施，接種疫苗的人口比例，以及有否變種病毒株肆虐等等。</div>
<div class="g-text">* * *</div>
<div class="g-text">智利是全球其中一個接種率最高的國家，現時全國已有 34% 人接種疫苗，而當地九成接種的都是中國科興疫苗。當地自一月中開始接種後，新增確診人數有上升趨勢，現時每週每百萬人有 2,427 人確診，比 3 月初多逾 1,000 人。主因相信與該國在未有足夠人口接種疫苗達到「群體免疫」時，<a href="https://www.theguardian.com/global-development/2021/mar/28/chile-coronavirus-lockdowns-vaccination-success">已重開賭場、戲院與健身室等場所</a>，令國民錯誤以為疫情最壞情況而過，結果疫情反彈，並須重新封城。</div>
<div class="g-graphic">
<div class="g-graphic-hed">智利</div>
<div class="g-vaccine-example" data-country="Chile"> </div>
</div>
<div class="g-text">另外，土耳其及巴西亦是主要接種科興疫苗，但接種的人口相對較少，已接種一劑疫苗的人口只為 10% ，仍遠低於<a href="https://www.nytimes.com/2020/12/24/health/herd-immunity-covid-coronavirus.html">多個專家估計 70–90% 人口有 COVID-19 免疫力的「免疫門檻」</a>，兩地疫情亦有反彈的趨勢。</div>
<div class="g-graphic">
<div class="g-graphic-hed">土耳其</div>
<div class="g-vaccine-example" data-country="Turkey"> </div>
</div>
<div class="g-graphic">
<div class="g-graphic-hed">巴西</div>
<div class="g-vaccine-example" data-country="Brazil"> </div>
</div>
<div class="g-subhed">英國、美國、以色列確診持續下降　歐洲多國反彈</div>
<div class="g-text">美國和英國的疫苗接種計劃發展較快，美國至今已為接近三成人口接種第一劑疫苗，英國則接近一半人已接種第一劑疫苗，同時兩國的新增確診人數亦呈顯著下跌的趨勢。</div>
<div class="g-graphic">
<div class="g-graphic-hed">美國</div>
<div class="g-vaccine-example" data-country="United States"> </div>
</div>
<div class="g-graphic">
<div class="g-graphic-hed">英國</div>
<div class="g-vaccine-example" data-country="United Kingdom"> </div>
</div>
<div class="g-text">以色列則是現時全球接種率最高國家之一， 58% 人接種了至少一劑 BioNTech 疫苗，其每週每百萬人確診數，已由一月下旬的近 7,000 人，下跌至現時的 388 人。雖然該國大部份封城措施已解除，但仍要求國民<a href="https://www.theguardian.com/world/2021/apr/06/israel-and-chile-both-led-on-covid-jabs-so-why-is-one-back-in-lockdown">繼續在戶外戴口罩，以及限制室內聚會人數</a>，都有助遏制疫情。</div>
<div class="g-graphic">
<div class="g-graphic-hed">以色列</div>
<div class="g-vaccine-example" data-country="Israel"> </div>
</div>
<div class="g-text">政府專家顧問、中大呼吸系統科講座教授許樹昌認為，不同國家的疫情走勢，除了判斷當地疫苗接種率，亦要審視當地國民是否有遵守社交距離措施等不同因素，他舉例以色列的國民紀律性高，現時疫苗已有 6 成多接種率，已開始顯示疫情有下跌趨勢，相反即使智利接種疫苗接種速度更期加快，但仍有新聞指有年輕人不戴口罩，參與不同聚會等，令疫情未見緩和，因此不能單從接種那款疫苗單一判斷。</div>
<div class="g-text">被問及如何判斷一個國家是否已達至群體免疫，許樹昌指即使以色列有 6 成多接種率，英國及美國亦分別有四成及三成多接種率，三國的疫走勢向開始有好轉，但亦未能稱為已達至「群體免疫」，並解釋「（群體免疫）係睇國家確診數字跌到幾低，如果達至群體免疫，例如要接種率高，得返零星個案。」</div>
<div class="g-text">呼吸系統專科醫生梁子超指，雖然現時以色列的疫情有緩和，但每日確診數字仍然是數以百計，與完全截斷當地傳播鏈仍有一段距離，並非已是「群體免疫」。相較於智利，梁子超提到由於南半球國家的防疫措施開始放寬，例如容許外遊、放寬社交距離措施等，令到疫情出現大型反彈。</div>
<div class="g-text">在意大利及德國，疫苗接種計劃發展較慢，兩地至今只有約一成人口接種了第一劑疫苗，而疫情近日亦見反彈。意大利在四月初錄得<a href="https://www.bbc.com/news/world-europe-56621342">單日約二萬宗</a>新增確診後，再次實施社交管制措施。</div>
<div class="g-graphic">
<div class="g-graphic-hed">意大利</div>
<div class="g-vaccine-example" data-country="Italy"> </div>
</div>
<div class="g-graphic">
<div class="g-graphic-hed">德國</div>
<div class="g-vaccine-example" data-country="Germany"> </div>
</div>
<div class="g-text">梁子超強調，多個國家從來不是以疫苗解決疫情反彈問題，「如果（變種病毒）傳播力增加兩倍，國內實際傳播速度仍然控制唔到，推廣疫苗計畫同時，控制疫情都係要靠社交距離同整體防控措施，唔係靠疫苗。疫苗要時間先可以生效，及要覆蓋大部份人口，根本上智利疫苗推廣速度，係冇辦法彌補病毒擴散速度。」</div>
<div class="g-text">至於何謂「群體免疫」，梁子超解釋只要大部份人接種疫苗，或透過自然感染病毒後產生抗體，令病毒不能群體間有效傳播，便可視作「群體免疫」。他指，武漢肺炎病毒的基本繁殖數為 3 至 5，即一人可傳染 3 至 5 人，因此一個地方須至少接種率 70 % 才有望可產生群體免疫，但當中未有計算疫苗保護性是否足夠，及疫苗能否覆蓋變種病毒。</div>
<div class="g-text">英國首相約翰遜（Boris Johnson）去年在疫情初期，曾提到讓市民感染，令到達到「群體免疫」。梁子超稱，理論上的確即是一個國家沒有提供疫苗接種，遲早當地亦可達至「群體免疫」，但犧牲的是沉重的醫療負擔，造成多人感染後死亡。他以智利為例，即使現時疫苗無法減輕疫情走勢，但當地的嚴重個案及死亡率有所下降，尤其是長者的死亡率是大幅下跌，「疫苗一定有佢作用，疫苗能唔能夠阻截社區傳播，如果阻截到，個案會跌；如果唔到，個案都係會跌，因為係自然感染令到群體免疫。」</div>
<div class="g-text">資料來源：<a href="https://ourworldindata.org/covid-vaccinations">Our World in Data</a></div>
</div>
<script src="https://interactive.thestandnews.com/scripts/d3_.js"></script><!-- <script src="https://interactive.thestandnews.com/2021/04/world-vaccines/new-cases.js"></script>
<script src="https://interactive.thestandnews.com/2021/04/world-vaccines/by_country.js"></script> --><script src="https://interactive.thestandnews.com/2021/04/world-vaccines/new-cases.js?zsrxedtcfyvghbunjm"></script><script src="https://interactive.thestandnews.com/2021/04/world-vaccines/by_country.js?zsrxedtcfyvghbunjm"></script><script src="https://interactive.thestandnews.com/2021/04/world-vaccines/vaxby_summary.js?zsrxedtcfyvghbunjm"></script><script src="https://interactive.thestandnews.com/2021/04/world-vaccines/locations.js?zsrxedtcfyvghbunjm"></script><script src="https://interactive.thestandnews.com/2021/04/world-vaccines/allvax.js?zsrxedtcfyvghbunjm"></script><script>
window.stopit = d3.timer(function(){
	d3.selectAll(".article-content-wrap:not(:first-child)").remove();
	d3.selectAll(".likecoin-embed:nth-child(n+3)").remove();
	d3.selectAll(".related-articles:nth-child(n+4)").remove();
})

var lookup = {
	"United Kingdom": {
		color: "#f4970f",
		pop: 66834.40,
		name: "英國"
	},
	"United States": {
		color: "#047a7a",
		pop: 328239.52,
		name: "美國"
	},
	"Brazil": {
		color: "#f4777f",
		pop: 211049.53,
		name: "巴西"
	},
	"Turkey": {
		color: "#cf3759",
		pop: 83429.62,
		name: "土耳其"
	},
	"Chile": {
		color: "#93003a",
		pop: 18952.04,
		name: "智利"
	},
	"Israel": {
		color: "#adb760",
		pop: 9053.30,
		name: "以色列"
	},
	"Italy": {
		color: "#d3b760",
		pop: 60297.40,
		name: "意大利"
	},
	"Germany": {
		color: "#e38ca3",
		pop: 83132.80,
		name: "德國"
	},
	"Indonesia": {
		color: "#6e8ca3",
		pop: 270625.57,
		name: "印尼"
	},
	"India": {
		color: "#9b8192",
		pop: 1366417.75,
		name: "印度"
	},
	"Singapore": {
		color: "#9b8192",
		pop: 5703.57,
		name: "新加坡"
	},
	"Hong Kong": {
		color: "#000",
		pop: 7507.40,
		name: "香港"
	},
	"all": {
		color: "#000"
	}
}

new_cases.forEach(function(d){
	var split = d.date.split("-");
	d.datef = new Date(split[0], split[1]-1, split[2]);

})

allvax.forEach(function(d){
	var split = d.date.split("-");
	d.datef = new Date(split[0], split[1]-1, split[2]);

})

var prev = 0, prev2 = 0, prev_country = "", start = false, start2 = false;
by_country.forEach(function(d){

	if (prev_country != d.location) {
		prev_country = d.location;
		prev = 0;
		prev2 = 0;
		start = false;
		start2 = false;
	}

	var split = d.date.split("-");
	d.datef = new Date(split[0], split[1]-1, split[2]);

	var pop = lookup[d.location].pop;
	d.pct_pop = d.people_vaccinated && d.people_vaccinated ? d.people_vaccinated/1000/pop : prev/1000/pop;
	d.pct_pop2 = d.people_fully_vaccinated && d.people_fully_vaccinated ? d.people_fully_vaccinated/1000/pop : prev/1000/pop;
	d.start = start;
	d.start2 = start2;

	if (d.people_vaccinated) {
		prev = d.people_vaccinated;
		prev2 = d.people_fully_vaccinated;
	}

	if (d.people_vaccinated && d.people_vaccinated > 0) {
		start = true;
	}

	if (d.people_fully_vaccinated && d.people_fully_vaccinated > 0) {
		start2 = true;
	}
})


function formatTime(d){
	return d.getFullYear() + "." + (+d.getMonth()+1) + "." + d.getDate();
}

function formatTime2(d){
	return +d.getMonth()+1 + "." + d.getDate();
}

function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

var vaccine_lookup = {
	"Pfizer/BioNTech": {
		name: "BioNTech",
		color: "rgba(0,160,255,0.05)"
	},
	"Sinovac": {
		name: "科興",
		color: "rgba(255,0,0,0.05)"
	},
	"Johnson&Johnson": {
		name: "強生",
		color: "rgba(0,0,0,0.05)"
	},
	"Oxford/AstraZeneca": {
		name: "阿斯利康",
		color: "rgba(0,160,0,0.05)"	
	}
}

function convertToSlug(Text)
{
    return Text
        .toLowerCase()
        .replace(/ /g,'-')
        .replace(/[^\w-]+/g,'')
        ;
}

function drawExamples() {

	var isMobile = innerWidth < 460;

	d3.selectAll(".g-vaccine-example").each(function(){

		var sel = d3.select(this).html("");

		var country = sel.attr("data-country");

		var all = country == "all";

		var summary = vaxby_summary.filter(d => d.location == country)

		var sumbox = sel.append("div.g-summary-box").html(all ? "" : "<b>疫苗</b>");

		if (!all && summary.length == 0) {
			var v = locations.filter(d => d.location == country)[0].vaccines.split(",");

			v.forEach(function(d){
				summary.push({
					location: country,
					total_vaccinations: 0,
					vaccine: d.trim()
				})
			})
		}

		var parent = d3.select(sel.node().parentNode);
		var total = d3.sum(summary, d => +d.total_vaccinations);

		if (!all) {
			summary.sort((a,b) => b.total_vaccinations - a.total_vaccinations);
			summary.forEach(function(d){
				var name_use = vaccine_lookup[d.vaccine] && vaccine_lookup[d.vaccine].name ? vaccine_lookup[d.vaccine].name : d.vaccine;

				var str = name_use;
				if (d.total_vaccinations > 0) {
					str += " " + Math.round(d.total_vaccinations / total * 100) + "%";
				}

				sumbox.append("div.g-text.g-vaccine-summary").text(str)
				// .style("background", vaccine_lookup[d.vaccine] && vaccine_lookup[d.vaccine].color ? vaccine_lookup[d.vaccine].color : "#f7f7f7")
			})
		}

		var charts = all ? ["vaccine"] : ["vaccine", "new_cases"];

		var selwidth = sel.node().getBoundingClientRect().width;
		var owidth = all ? selwidth  - 12.5 : (selwidth/2) - 12.5;
		var margin = {top: 0, right: 10, bottom: 25, left: 5};

		var maxcases = d3.max(new_cases, d => d[country])/6000;
		var maxpct = d3.max(by_country.filter(d => d.location == country && d.start), d => d.pct_pop)/0.5;
		maxpct = all ? 0.8 : maxpct;

		var use = maxcases > maxpct ? maxcases : maxpct;

		charts.forEach(function(chart){

			var div = sel.append("div.g-vaccine-each");
			div.append("div.g-chart-hed").html(chart == "vaccine" ? "已接種疫苗人口百份比" : "每週新增個案<i>按各國人口比例，每百萬人</i>")

			if (chart == "vaccine" && !all) {
				var key = div.append("div.g-key")

				var key1 = key.append("div.g-key-each");
				key1.append("div.g-key-rect").style("background", lookup[country].color).style("opacity", 0.4)
				key1.append("div.g-key-label").text("第一針")

				var key2 = key.append("div.g-key-each");
				key2.append("div.g-key-rect").style("background", lookup[country].color).style("opacity", 0.8)
				key2.append("div.g-key-label").text("第二針")

			}

			var dat = all ? allvax : chart == "vaccine" ? by_country.filter(d => d.location == country && d.start) : new_cases;

			var width = owidth;
			var height = all ? 500 : owidth;

			var height_use = all ? 500 : height*use;

			var svg = div.append("svg").attr("width", width).attr("height", height_use + margin.bottom);
			if (!all) {
				height -= margin.top + margin.bottom;
			}
			width -= margin.left + margin.right;

			svg = svg.append("g").translate([margin.left, height_use - height]);

			if (dat.length > 0) {

				var x = d3.scaleLinear().domain([new Date("2020-12-15"), new Date("2021-04-20")]).range([0,width]);
				var domain = all ? [0,0.6] : chart == "vaccine" ? [0,0.6] : [0,6000]
				var y = d3.scaleLinear().domain(domain).range([height,0]);

				var xaxis = d3.axisBottom(x)
					.tickValues([new Date(2021,0,1), new Date(2021,1,1), new Date(2021,2,1), new Date(2021,3,1)])
					.tickFormat(function(d){
						var newd = new Date(d);
						return (newd.getMonth()+1) + "月";
					});

				var maxcases = d3.max(new_cases, d => d[country]);
				var cases_tv = [1000,2000,3000,4000,5000,6000];

				var maxpct = d3.max(dat, d => d.pct_pop);
				var v_tv = [.1,.2,.3,.4,.5];

				var tickvals = chart == "vaccine" ? v_tv.filter(d => d < maxpct || d == 0.1 || d == 0.2) : cases_tv.filter(d => d < maxcases)
				var yaxis = d3.axisLeft(y).tickSize(width)
					.tickValues(tickvals)
					.tickFormat(d => chart == "vaccine" ? d*100 + "%" : numberWithCommas(d));

				svg.append("g.x.axis").translate([0,height]).call(xaxis)
				svg.append("g.y.axis").translate([width-margin.left, 0]).call(yaxis)
				svg.selectAll(".y.axis .tick").each(function(){
					var el = d3.select(this);
					var text = el.select("text")
					text.attr("x", -width+1)
					var textbb = text.node().getBoundingClientRect();
					el.insert("rect", "text")
						.style("fill", "#f7f7f7")
						.translate([-width,-textbb.height/2])
						.attr("width", textbb.width+3)
						.attr("height", textbb.height < 0 ? 0 : textbb.height)
				});


				var pop = lookup[country].pop;

				var types = all ? ["pct_pop"] : chart == "vaccine" ? ["pct_pop", "pct_pop2"] : [country];

				types.forEach(function(type,ti){

					var line = d3.line()
						.x(d => x(d.datef))
						.y(d => y(d[type]))

					var area = d3.area()
						.x(d => x(d.datef))
						.y0(height)
						.y1(d => y(d[type]))


					var dat2 = all ? allvax : type == "pct_pop2" ?  dat.filter(d => d.start2) : dat.filter(d => d[type] && d.datef > new Date("2021-01-01"));
					var thiscol = lookup[country] && lookup[country].color ? lookup[country].color : "#000";

					if (all) {

						var grouped = d3.nest().key(d => d.location).entries(allvax)
						var dontuse = ["Gibraltar", "Seychelles"]
						var keys = Object.keys(lookup)

						grouped.forEach(function(d){
							if (keys.indexOf(d.key) > -1) {
								var hk = d.key == "Hong Kong";
								var tc = lookup[d.key] && lookup[d.key].color ? lookup[d.key].color : "#ddd";

								svg.append("path")
									.datum(d.values)
									.attr("data-country", d.key)
									.attr("d", line)
									.style("stroke-width", 2)
									.style("stroke", tc);

								var last = d.values[d.values.length - 1];
								var lastg = svg.append("g").translate([x(last.datef), y(last[type])])

								lastg.append("circle").attr("r", 2)
									.style("fill", tc)
								
								lastg.append("text.g-lab")
									.style("font-size", innerWidth < 600 ? "9px" : "10px")
									.style("fill", tc)
									.style("font-weight", hk ? 700 : "normal")
									.translate(d.key == "Hong Kong" ? [5,-3] : d.key == "Brazil" ? [5,-3] : d.key == "Indonesia" ? [5,5] : d.key == "Germany" ? [5,-6] : d.key == "Turkey" ? [5,5] : [5,0])
									.style("text-anchor", chart == "vaccine" ? "start" : "middle")
									.text(lookup[d.key].name + " " + Math.round(last[type] * 100) + "%")

							}
						})
						

					} else {

						svg.append("path")
							.datum(dat2)
							.attr("d", area)
							.style("fill-opacity", 0.4)
							.style("fill", thiscol);

						svg.append("path")
							.datum(dat2)
							.attr("d", line)
							.style("stroke-width", 2)
							.style("stroke", thiscol);

						var last = dat2[dat2.length - 1];
						var lastg = svg.append("g").translate([x(last.datef), y(last[type])])

						lastg.append("circle").attr("r", 3)
							.style("fill", thiscol)

						if (chart == "vaccine") {
							lastg.append("text.g-lab")
								.translate(type == "pct_pop" && country == "Turkey" ?  [0,-5] : [5,0])
								.style("text-anchor", chart == "vaccine" ? "start" : "middle")
								.text(function(d) {
									if (chart == "vaccine") {
										return Math.round(last[type] * 100) + "%";
									} else {
										return numberWithCommas(Math.round(last[type]));
									}
								})
						}


					}




					
				})

				
				
			}
			



		})

		

	})

}

// drawNewCases();

drawExamples();


var containerWidthChanged = false;
var ow = innerWidth;

window.addEventListener("resize", function(){
	if (innerWidth != ow) {
	    containerWidthChanged = true;
	    ow = innerWidth;
	    // drawNewCases();
	    topchart();
	    drawExamples();
	  }
});
</script></meta></meta>
